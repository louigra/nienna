<!-- configurator.html -->
<!doctype html>
<html lang="en" data-bs-theme="dark">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Nienna — Configurator</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <link href="./styles.css" rel="stylesheet"/>
  <style>
    .layout { display: grid; grid-template-columns: 280px 1fr; min-height: 100vh; }
    .sidebar {
      border-right: 1px solid rgba(255,255,255,.08);
      background: rgba(15,15,18,.5); backdrop-filter: blur(8px);
    }
    .sidebar .active { background: rgba(255,255,255,.08); }
    .toolbar { border-bottom: 1px solid rgba(255,255,255,.08); }
    .table-wrap { overflow:auto; }
  </style>
</head>
<body>
  <div class="layout">
    <!-- Left toolbar -->
    <aside class="sidebar p-3">
      <h2 class="h6 text-secondary mb-3">Tables</h2>
      <nav id="table-list" class="list-group list-group-flush small"></nav>
      <hr class="text-secondary my-3" />
      <div id="sidebar-extra" class="small text-secondary"></div>
    </aside>

    <!-- Right pane -->
    <main class="d-flex flex-column">
      <div class="toolbar p-3 d-flex gap-2 align-items-center">
        <h1 id="page-title" class="h5 mb-0 flex-grow-1">Configurator</h1>
        <input id="search-input" class="form-control form-control-sm" placeholder="Search…" style="max-width:220px"/>
        <button id="add-btn" class="btn btn-primary btn-sm">Add</button>
      </div>

      <div id="filters" class="p-3 d-flex flex-wrap gap-2"></div>
      <div class="p-3 table-wrap">
        <div id="table-region" class="table-responsive"></div>
        <div id="pager" class="d-flex justify-content-between align-items-center mt-3 small"></div>
        <p id="status" class="text-secondary small mt-2"></p>
      </div>
    </main>
  </div>

  <!-- Modal host -->
  <div id="modal-host"></div>

  <script type="module">
    import { requireAuth } from "../auth-guard.js";
    import { initRouter } from "./modules/router.js";
    import { buildSidebar } from "./modules/ui/sidebar.js";
    import { renderTableView } from "./modules/ui/tableView.js";
    import { TABLES } from "./modules/tables.config.js";

    await requireAuth();

    // Build sidebar from registry
    buildSidebar(document.getElementById('table-list'), TABLES);

    // Router: keeps ?t=tablename, p=page, q=search in sync with UI
    initRouter({
      onChange: ({ tableKey, page=1, q="" }) => {
        const def = TABLES[tableKey] ?? TABLES[Object.keys(TABLES)[0]];
        document.getElementById('page-title').textContent = def.title;
        renderTableView({
          def,
          container: document.getElementById('table-region'),
          filtersEl: document.getElementById('filters'),
          pagerEl: document.getElementById('pager'),
          statusEl: document.getElementById('status'),
          addBtn: document.getElementById('add-btn'),
          searchInput: document.getElementById('search-input'),
          page,
          search: q
        });
      }
    });
  </script>
</body>
</html>