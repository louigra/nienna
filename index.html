<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Supabase + GitHub Pages</title>
  <style>
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;margin:2rem}
    table{border-collapse:collapse;margin-top:1rem;width:100%;max-width:900px}
    th,td{border:1px solid #e5e7eb;padding:.5rem .7rem;text-align:left}
    th{background:#f8fafc}
    #status{opacity:.8}
    .controls{display:flex;gap:.5rem;flex-wrap:wrap;margin:.5rem 0}
    input,select,button{padding:.45rem .6rem;border:1px solid #cbd5e1;border-radius:.5rem}
  </style>
  <!-- Tip: for repos that use underscores in folders, add a .nojekyll file at the root -->
</head>
<body>
  <h1>Projects</h1>
  <p id="status">Loading…</p>

  <div class="controls">
    <input id="search" placeholder="Search name…" />
    <select id="category">
      <option value="">All categories</option>
      <option>Network</option>
      <option>RF</option>
      <option>Core</option>
    </select>
    <button id="reload">Reload</button>
  </div>

  <div id="out"></div>

  <script type="module">
    import { createClient } from "https://esm.sh/@supabase/supabase-js@2";

    // === Replace with your project values ===
    const SUPABASE_URL = "https://nnktuardzsmmckjzrgij.supabase.co";
    const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5ua3R1YXJkenNtbWNranpyZ2lqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTg2NzU4MTYsImV4cCI6MjA3NDI1MTgxNn0.a4yi_syViC9lYuRMx4YmaVOCvFdpPXLVtdAnXJQlpD0";
    // =======================================

    const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
    const status = document.getElementById('status');
    const out = document.getElementById('out');
    const search = document.getElementById('search');
    const category = document.getElementById('category');
    const reloadBtn = document.getElementById('reload');

    async function loadData() {
      status.textContent = "Loading…";
      out.innerHTML = "";

      let q = supabase
        .from('projects_programming')
        .select('id,project_title,year1value,year2value,year3value,year4value,year5value')
        .order('id', { ascending: true });

      if (search.value.trim()) {
        // Case-insensitive LIKE; use ilike for PostgREST
        q = q.ilike('name', `%${search.value.trim()}%`);
      }
      if (category.value) {
        q = q.eq('category', category.value);
      }

      const { data, error } = await q;
      if (error) {
        status.textContent = "Error: " + error.message;
        console.error(error);
        return;
      }

      status.textContent = `Loaded ${data.length} row(s) ✓`;
      renderTable(data);
    }

    function renderTable(rows) {
      if (!rows.length) { out.textContent = "No rows."; return; }
      const table = document.createElement('table');
      const headers = ['id','name','cost','category','created_at'];

      const thead = document.createElement('thead');
      const hr = document.createElement('tr');
      for (const h of headers) {
        const th = document.createElement('th'); th.textContent = h; hr.appendChild(th);
      }
      thead.appendChild(hr); table.appendChild(thead);

      const tbody = document.createElement('tbody');
      for (const r of rows) {
        const tr = document.createElement('tr');
        for (const h of headers) {
          const td = document.createElement('td');
          td.textContent = r[h] ?? '';
          tr.appendChild(td);
        }
        tbody.appendChild(tr);
      }
      table.appendChild(tbody);
      out.appendChild(table);
    }

    reloadBtn.addEventListener('click', loadData);
    search.addEventListener('input', () => { /* simple debounce */ clearTimeout(window._t); window._t=setTimeout(loadData, 250); });
    category.addEventListener('change', loadData);

    loadData();
  </script>
</body>
</html>